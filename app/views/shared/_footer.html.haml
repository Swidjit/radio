%footer.footer
  .row
    .small-12.medium-6.large-3.columns
      %p.logo
        %i.fi-shield
        Crazy Dancing Guy
      %p.footer-links
        =link_to "About", pages_path("about")
        =link_to "How it Works", pages_path("how-it-works")
        =link_to "Privacy Policy", pages_path("privacy")
        =link_to "Contact Me", '/contact-us'
        -if user_signed_in?

          = link_to "Log out", destroy_session_path(:user), :method => :delete

    .small-12.medium-6.large-4.columns
      %p.logo Socialize with us
      %ul.contact
        %li
          %p
            %i.fi-social-facebook>
            =link_to 'facebook.com/CrazyDancingGuy', 'http://facebook.com/CrazyDancingGuy'
        %li
          %p
            %i.fi-social-twitter>
            =link_to 'twitter.com/CrazyDancingGuy', 'http://twitter.com/CrazyDancingGuy'

    .small-12.medium-6.large-5.columns

      %ul.hashtags
        %h3=link_to '@crazydancingguy',"http://crazydancingguy.com"
        %li=link_to '#climatejustice', 'https://twitter.com/hashtag/climatejustice'
        %li=link_to '#socialjustice', 'https://twitter.com/hashtag/socialjustice'
        %li=link_to '#genderequality', 'https://twitter.com/hashtag/genderequality'
      %hr
      .footer-links{:style=>'text-align:center;'}
        =link_to "Play With Your Mind", "http://playwithyourmind.com"
        =link_to "Presidential Election Games", "http://presidentialelectiongames.com"
        =link_to "The Keyboard Playground", "http://freeonlinetypinggames.com"
        =link_to "Good Luck Test", "http://goodlucktest.com"

#login.reveal-modal.remove-whitespace{"data-reveal" => ""}
  .row
    .large-6.columns.auth-plain
      .signup-panel.left-solid
        %p.welcome Registered Users
        %form#login-form
          .row.collapse
            .small-2.columns
              %span.prefix
                %i.fi-torso-female
            .small-10.columns
              %input{:placeholder => "username", :type => "text", :id =>'login-username'}
          .row.collapse
            .small-2.columns
              %span.prefix
                %i.fi-lock
            .small-10.columns
              %input{:placeholder => "password", :type => "password", :id => 'login-password'}
        %a.button{:href => "#",:id=>'login-button'} Log In
    .large-6.columns.auth-plain
      .signup-panel.newusers
        %p.welcome No account... yet?
        %p Why not sign up and exercise your first ammendment right to have some fun?  It's easy!
        =link_to new_user_registration_path, :class=>'button' do
          Sign Up
  %a.close-reveal-modal ×

#new-post.reveal-modal{"data-reveal" => ""}
  #form
  %a.close-reveal-modal ×

:javascript
  var current_song;
  var current_filename;
  var root_url;
  var filenames = {};
  var song_names = {};
  var song_shows = {};
  var song_ids = {};
  var shuffle_mode = false;
  var radio_mode = false;
  var current_track;
  $('#login-button').on('click', function() {
    var data = {
      user: {login: $('#login-username').val(), password: $('#login-password').val(), remember_me: '1'}
    }

    $.ajax({ url: '/users/sign_in',
      type: 'POST',
      headers: {
          'X-CSRF-Token': '<%= form_authenticity_token.to_s %>'
        },
      data: data,
      success: function(response) {
        $('#login').foundation('reveal','close');
        $('.menu ul.inline-list').empty();
        setTimeout(function() {
           $('.menu ul.inline-list').html('#{escape_javascript render :partial=>"users/header_menu"}');
           window.location = '#{root_path}';
        }, 1000);


      },
      error: function(xhr, status, error) {
          alert(xhr.responseText);
       }
    });
  });



  $(document).on('click', '.play-song', function() {
    $('#player').show();
    current_track = parseInt($(this).attr("track"))-1;
    show_id = $(this).attr("show_id");
    root_url = 'https://archive.org/download/'+show_id+'/';
    playSong($(this));
  });

  $(document).on('click', '.pause', function() {
    current_song.pause();
    $('#player .play').show();
    $('#player .pause').hide();
  });
  $(document).on('click', '.play', function() {
    current_song.play();
    $('#player .play').hide();
    $('#player .pause').show();
  });
  document.addEventListener('ended', function(e){
    if($(e.target).is('audio')){
      if(shuffle_mode) {
        $.get('/songs/shuffle');
      }
      else if(radio_mode) {
        console.log('radio');
        $.get('/songs/radio');
      }
      else {
        current_track += 1;
        playSong();
      }


    }
  }, true);


  function playSong(song) {
      filename = '';
      song_name = '';
      if(filenames[show_id]) {

        filename = filenames[show_id][current_track];
        console.log(song_ids);
        song_id  = song_ids[show_id][current_track];
        song_name = song_names[show_id][current_track];
        song_show = song_shows[show_id];
      }
      else {
        console.log(song.attr('filename'));
        filename = song.attr('filename');
        song_name = song.attr('title');
        song_show = song.attr('show');
        song_id = song.attr('song_id');
        console.log(song_id);
      }
      src=root_url+filename;
      html='<audio id="current-song" src="'+src+'"></audio>';
      $('#player #song').html(html);
      $('#player .play').hide();
      $('#player .pause').show();
      $('#show-list').removeClass('large-12 large-6');
      $('#show-list').removeClass('medium-12 medium-6');
      $('#show-list').addClass('large-6');
      $('#show-list').addClass('medium-6');
      $.get('/songs/load/'+song_id);

      current_filename = filename;
      current_song = document.getElementById('current-song');
      current_song.play();
      current_song.addEventListener("timeupdate", function() {
          var duration = parseInt( current_song.duration ),
              currentTime = parseInt( current_song.currentTime ),
              timeLeft = duration - currentTime,
              s, m;


          s = timeLeft % 60;
          m = Math.floor( timeLeft / 60 ) % 60;

          s = s < 10 ? "0"+s : s;
          m = m < 10 ? "0"+m : m;

          $('#player .song-time').html(m+":"+s);

      }, false);
      $('#player .song-title').html(song_name);
      $('#player .song-show').html(song_show);
  }

  $(document).on('click','.shuffle',function() {
    shuffle_mode = !shuffle_mode;
    $(this).toggleClass('selected');

  });
  $(document).on('click','.radio',function() {
    radio_mode = !radio_mode;
    $(this).toggleClass('selected');

  });
  $(document).on('click','.refresh',function() {
    $.get('/songs/shuffle');

  });

  $(document).on('mouseover','.vote',function() {
    labels = ['never','infrequently','regularly','frequently'];
    num = $(this).index();
    $('.vote-lebel').html(labels[num]);

    do {
    $('.votes .vote:eq('+num+')').css('opacity','1');
    num--;
    } while(num>=0);

  });
  $(document).on('mouseout','.vote',function() {
    if($('.votes').hasClass('votable')) {
      $('.vote').css('opacity','.4');
    }


  });
  $(document).on('click','.song-frequency-label',function() {
    $('.song-frequency').toggle();
  });

  $(document).on('click','.show',function() {
    $(this).find('.show-songs').toggle();
    if($(this).find('.show-title').hasClass('expanded')) {
      $(this).find('.show-title').removeClass('expanded');
    }
    else {
      $(this).find('.show-title').addClass('expanded');
    }

  });


